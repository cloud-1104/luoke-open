# 洛克王国自动激活工具

自动获取洛克王国每日公告中的资格码并进行兑换的工具。

禁止去除水印，禁止二次售卖或售卖帮抢名额
禁止使用软件盈利

## 🎉 v2 版本核心更新

### 扫码登录 - 告别抓包时代

- ✅ **QQ 扫码登录**：一键生成二维码，QQ 扫码即可获取网页端 Cookie，无需手动抓包
- ✅ **微信扫码登录**：同样支持微信扫码登录，自动获取凭证
- ✅ **小程序免令牌**：不再需要从小程序抓取 Authorization token，直接使用网页端 Cookie
- ✅ **流程简化**：从"需要学会抓包工具"到"点击按钮扫码"，降低 80% 使用门槛

**v1 vs v2 对比：**

| 功能 | v1 版本 | v2 版本 |
|------|---------|---------|
| 网页端 Cookie | 需要 F12 手动复制 | QQ/微信扫码自动获取 |
| 小程序 Authorization | 需要抓包工具获取 | **已废弃，无需配置** |
| 技术门槛 | 需要了解抓包 | 只需会扫二维码 |
| Token 过期处理 | 手动重新抓包 | 点击按钮重新扫码 |

## 洛克王国交流群

![42e75989a3f7f6d96f7c037d24fd6236.jpg](42e75989a3f7f6d96f7c037d24fd6236.jpg)

## 功能特性

- ✅ 多线程高频请求公告列表,提高成功率
- ✅ 自动提取公告中的资格口令
- ✅ 支持OCR自动识别验证码或手动输入
- ✅ GUI图形化界面,配置简单
- ✅ 按日期保存日志
- ✅ 配置持久化保存

## 目录结构

```
luoke/
├── src/                    # 源代码目录
│   ├── config_manager.py   # 配置管理模块
│   ├── logger.py           # 日志管理模块
│   ├── api_client.py       # HTTP接口封装
│   ├── announcement_fetcher.py  # 多线程公告获取
│   ├── password_extractor.py    # 口令提取模块
│   ├── captcha_handler.py       # 验证码处理模块
│   ├── redeemer.py              # 兑换控制器
│   ├── qq_login.py              # QQ扫码登录模块 (v2新增)
│   ├── wx_login.py              # 微信扫码登录模块 (v2新增)
│   └── gui.py                   # GUI界面
├── main.py                 # 程序入口
├── config.json             # 配置文件(首次运行自动生成)
├── logs/                   # 日志目录(自动生成)
├── requirements.txt        # 依赖列表
└── README.md               # 说明文档
```

## 安装依赖

```bash
pip install -r requirements.txt
```

### 依赖说明

- `requests`: HTTP请求库
- `beautifulsoup4`: HTML解析库
- `Pillow`: 图片处理库
- `ddddocr`: OCR识别库(仅OCR模式需要,体积约20MB)

**注意**: 如果只使用手动输入验证码模式,可以不安装`ddddocr`。

## 使用方法

### 1. 运行程序

```bash
python main.py
```

### 2. 配置信息

在"配置"选项卡中填写以下信息:

- **网页端Cookie**:
  - **v2 新方式（推荐）**: 点击"QQ扫码登录"或"微信扫码登录"按钮，扫码后自动填充
  - **传统方式**: 手动从浏览器 F12 复制 Cookie（不推荐）
- **公告关键字**: 例如`Day1`, `Day2`等,用于匹配目标公告
- **验证码识别方式**: 选择手动输入或OCR自动识别
- **OCR失败重试次数**: OCR识别失败后的重试次数(超过后自动切换到手动输入)
- **请求线程数**: 多线程请求公告列表的线程数(默认10,可根据网络情况调整)
- **请求超时**: HTTP请求超时时间(秒)

**重要变更**: v2 版本已废弃"小程序 Authorization"字段，无需配置。

配置完成后点击"保存配置"按钮。

### 3. 执行兑换

切换到"执行"选项卡,点击"开始执行"按钮,程序将自动:

1. 使用多线程高频请求公告列表
2. 查找包含关键字的公告并获取详情
3. 从HTML中提取资格口令
4. 获取验证码(OCR识别或弹窗手动输入)
5. 调用兑换接口完成兑换
6. 显示兑换结果

执行过程中的所有日志会实时显示在界面上,并保存到`logs/`目录下的日期文件中。

## 获取Cookie - v2 简化流程

### 🎯 推荐方式：扫码登录（v2 新增）

#### QQ 扫码登录

1. 打开软件，切换到"配置"选项卡
2. 点击"QQ扫码登录"按钮
3. 弹出二维码窗口，使用手机 QQ 扫码
4. 手机上确认登录
5. Cookie 自动填充到配置框，点击"保存配置"即可

#### 微信扫码登录

1. 点击"微信扫码登录"按钮
2. 使用微信扫码并确认
3. Cookie 自动填充，保存即可

**优势**:
- 无需学习抓包工具
- 无需手动复制粘贴
- Token 过期后一键重新扫码

---

### 传统方式：手动获取（不推荐）

如果扫码登录失败，可使用传统方式：

1. 打开浏览器(Chrome/Edge),按F12打开开发者工具
2. 访问`https://rocom.qq.com/act/a20250901certification/`
3. 切换到Network选项卡,刷新页面
4. 找到任意请求,复制请求头中的完整`Cookie`字段值

**安全提示**: Cookie 包含敏感信息,请勿泄露给他人。

## 打包为EXE

使用PyInstaller将程序打包为独立exe文件:

### 1. 安装PyInstaller

```bash
pip install pyinstaller
```

### 2. 打包命令

```bash
pyinstaller --onefile --windowed --name "洛克王国自动激活" --icon=icon.ico main.py
```

参数说明:
- `--onefile`: 打包为单个exe文件
- `--windowed`: 不显示控制台窗口(GUI程序)
- `--name`: 生成的exe文件名
- `--icon`: 程序图标(可选,需要准备.ico文件)

打包完成后,exe文件在`dist/`目录下。

### 3. 打包注意事项

如果使用OCR模式,需要额外配置:

```bash
pyinstaller --onefile --windowed --name "洛克王国自动激活" \
    --hidden-import=ddddocr \
    --collect-data ddddocr \
    main.py
```

这会增加exe文件体积(约100MB+),但可以独立运行OCR功能。

**建议**: 如果追求小体积,打包时不包含ddddocr,只使用手动输入模式,exe大小约10MB。

## 常见问题

### Q1: 请求公告列表总是超时?

**A**: 检查以下几点:
- Cookie 是否过期（v2: 点击扫码登录按钮重新获取）
- 网络连接是否正常
- 尝试增加"请求超时"时间
- 尝试减少"请求线程数"

### Q2: 提取口令失败?

**A**: 公告HTML格式可能变化,请检查:
- 确认公告中确实包含资格码
- 查看日志中的错误信息
- 如有需要,可联系开发者更新提取规则

### Q3: OCR识别总是失败?

**A**: 验证码OCR识别准确率约60-80%,建议:
- 使用"手动输入"模式(更可靠)
- 或设置较高的"OCR失败重试次数",超过后自动切换手动输入

### Q4: 兑换提示"验证码错误"?

**A**:
- 手动输入时请仔细辨认验证码(注意大小写)
- 验证码有时效性,如果识别太慢可能失效,需重新获取

### Q5: 兑换提示"口令已被使用"?

**A**: 资格码有数量限制,先到先得,说明已被抢完,请等待下次活动。

## 技术架构

- **语言**: Python 3.8+
- **GUI框架**: Tkinter(Python标准库,无需额外安装)
- **HTTP请求**: requests
- **HTML解析**: BeautifulSoup4
- **OCR识别**: ddddocr(基于深度学习的中文OCR)
- **多线程**: threading(Python标准库)

## 代码规范

- 所有模块都有完整的文档字符串
- 遵循PEP 8代码规范
- 关键逻辑都有注释说明
- 错误处理完善,不会因异常崩溃

## 免责声明

本工具仅供学习交流使用,请遵守洛克王国相关服务条款。使用本工具产生的任何后果由使用者自行承担。

## 开源协议

MIT License

## 更新日志

### v2.0.0 (2025-10-29)
- 🎉 **重大更新**: 新增 QQ/微信扫码登录功能
- 🎉 **破坏性变更**: 废弃小程序 Authorization 配置项
- ✅ 用户无需学习抓包工具，扫码即可获取 Cookie
- ✅ 新增 `src/qq_login.py` - QQ 登录模块
- ✅ 新增 `src/wx_login.py` - 微信登录模块
- ✅ GUI 新增"QQ扫码登录"和"微信扫码登录"按钮
- ✅ Cookie 自动填充到配置框
- ✅ 降低 80% 使用门槛

### v1.0.0 (2025-10-24)
- ✅ 初始版本发布
- ✅ 支持多线程高频请求
- ✅ 支持OCR和手动输入两种验证码模式
- ✅ GUI图形化界面
- ✅ 配置持久化和日志记录
